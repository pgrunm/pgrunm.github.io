<!doctype html><html lang=en><head><title>Developing Flutter apps with cloud infrastructure: Part 1 · Engineering Blog
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Pascal Grundmeier"><meta name=description content="This post shows how create AWS architecture with Terraform for working Jenkins installation."><meta name=keywords content="blog,devops engineer,site reliability engineer"><meta name=twitter:card content="summary"><meta name=twitter:title content="Developing Flutter apps with cloud infrastructure: Part 1"><meta name=twitter:description content="This post shows how create AWS architecture with Terraform for working Jenkins installation."><meta property="og:url" content="https://pgrunm.github.io/posts/infrastructure_flutter_part1/"><meta property="og:site_name" content="Engineering Blog"><meta property="og:title" content="Developing Flutter apps with cloud infrastructure: Part 1"><meta property="og:description" content="This post shows how create AWS architecture with Terraform for working Jenkins installation."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-04-21T21:12:43+01:00"><meta property="article:modified_time" content="2021-04-21T21:12:43+01:00"><meta property="article:tag" content="DevOps"><meta property="article:tag" content="Flutter"><meta property="article:tag" content="AWS"><meta property="article:tag" content="Jenkins"><meta property="article:tag" content="Terraform"><link rel=canonical href=https://pgrunm.github.io/posts/infrastructure_flutter_part1/><link rel=preload href="https://pgrunm.github.io/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=https://pgrunm.github.io/css/coder.min.0669b62fc2c181a12a4ba10be9984e385c9a5e83dc7cb7ae3759ad0b98d7e8b2.css integrity="sha256-Bmm2L8LBgaEqS6EL6ZhOOFyaXoPcfLeuN1mtC5jX6LI=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://pgrunm.github.io/css/coder-dark.min.f6534b0b446b75d9b6ad77a97d43ede2ddaeff1b6e2361fb7198d6f8fcb7f83f.css integrity="sha256-9lNLC0Rrddm2rXepfUPt4t2u/xtuI2H7cZjW+Py3+D8=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=https://pgrunm.github.io/img/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://pgrunm.github.io/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=https://pgrunm.github.io/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=https://pgrunm.github.io/images/apple-touch-icon.png><link rel=manifest href=https://pgrunm.github.io/site.webmanifest><link rel=mask-icon href=https://pgrunm.github.io/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.128.2"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://pgrunm.github.io/>Engineering Blog
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://pgrunm.github.io/>Home</a></li><li class=navigation-item><a class=navigation-link href=https://pgrunm.github.io/posts/>Articles</a></li><li class=navigation-item><a class=navigation-link href=https://pgrunm.github.io/about/>About Me</a></li><li class=navigation-item><a class=navigation-link href=https://pgrunm.github.io/contact/>Contact</a></li><li class=navigation-item><a class=navigation-link href=https://pgrunm.github.io/index.xml>RSS</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://pgrunm.github.io/posts/infrastructure_flutter_part1/>Developing Flutter apps with cloud infrastructure: Part 1</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2021-04-21T21:12:43+01:00>April 21, 2021
</time></span><span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
17-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=https://pgrunm.github.io/tags/devops/>DevOps</a>
</span><span class=separator>•</span>
<span class=tag><a href=https://pgrunm.github.io/tags/flutter/>Flutter</a>
</span><span class=separator>•</span>
<span class=tag><a href=https://pgrunm.github.io/tags/aws/>AWS</a>
</span><span class=separator>•</span>
<span class=tag><a href=https://pgrunm.github.io/tags/jenkins/>Jenkins</a>
</span><span class=separator>•</span>
<span class=tag><a href=https://pgrunm.github.io/tags/terraform/>Terraform</a></span></div></div></header><div class=post-content><h2 id=introduction>Introduction
<a class=heading-link href=#introduction><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Hello again! It&rsquo;s been a while, because I finally finished my studied and I&rsquo;m now Bachelor of Science :-). Anyway, I wanted to create a blog post of my bachelor thesis and this is going to be the one.</p><p>The topic of my thesis was how to speed up development performance when developing Flutter applications with cloud infrastructure. The infrastrcture was completely created with Terraform in AWS. The architecture itself is based on a sample <a href=https://github.com/aws-samples/jenkins-on-aws class=external-link target=_blank rel=noopener>published by AWS itself</a>. It consists of:</p><ul><li>an internet gateway (for access from public of course)</li><li>an application loadbalancer (which I replaced by an Elastic Loadbalancer)</li><li>NAT gateways for network address translation of public to private IP adresses and</li><li>the Jenkins leader as well as the agents of course</li></ul><p>As this is of course the current state of the architecture, this can be changed anytime, because everything was completely created using Terraform.</p><p><img src=https://pgrunm.github.io/images/infrastructure-flutter/aws_architektur_jenkins.png alt="This is an image" title="Image of the AWS architecture"></p><p>This image shows a simplified view of the architecture itself. It&rsquo;s created over two AZs (eu-central-1a and eu-central-1b) in this example. The AZs can be configured within the Terraform config. It&rsquo;s even possible to distribute the infrastructure about more than only two AZs.</p><h2 id=provisioning-of-the-cloud-infrastructure>Provisioning of the cloud infrastructure
<a class=heading-link href=#provisioning-of-the-cloud-infrastructure><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Let&rsquo;s start with the provisioning of the AWS infrastructure. As I appreciate automation a lot I did not build any infrastructure by hand. Instead I used Terraform to create every necessary piece of infrastructure, from the VPC until the Jenkins leader. The most interesting parts as of now are the main file and the variables.</p><h3 id=terraform-main-file>Terraform main file
<a class=heading-link href=#terraform-main-file><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>The content below is inside the <code>main.tf</code> file. It basically created all necessary security groups, subnets as well as the Elastic Container Service.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#66d9ef>provider</span> <span style=color:#e6db74>&#34;aws&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>region</span> = <span style=color:#e6db74>&#34;eu-central-1&#34;</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># We need a cluster in which to put our service.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_ecs_cluster&#34;</span> <span style=color:#e6db74>&#34;JenkinsThesisAwsDev&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span> = var.<span style=color:#a6e22e>application_name</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Log groups hold logs from our app.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_cloudwatch_log_group&#34;</span> <span style=color:#e6db74>&#34;JenkinsThesisAwsDev&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;/ecs/</span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>application_name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # Delete Logs after 7 days
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>retention_in_days</span> = <span style=color:#ae81ff>7</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # Write the environment into tags
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Environment&#34;</span> <span style=color:#f92672>=</span> var.<span style=color:#a6e22e>environment</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># The main service.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_ecs_service&#34;</span> <span style=color:#e6db74>&#34;JenkinsThesisAwsDev&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>            = <span style=color:#e6db74>&#34;ecs_service_</span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>application_name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>task_definition</span> = <span style=color:#a6e22e>aws_ecs_task_definition</span>.<span style=color:#a6e22e>jenkins_master</span>.<span style=color:#a6e22e>arn</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cluster</span>         = <span style=color:#a6e22e>aws_ecs_cluster</span>.<span style=color:#a6e22e>JenkinsThesisAwsDev</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>launch_type</span>     = <span style=color:#e6db74>&#34;FARGATE&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # Require service version 1.4.0!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>platform_version</span> = <span style=color:#e6db74>&#34;1.4.0&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>desired_count</span> = <span style=color:#ae81ff>1</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # Register the master and the port in dns
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>service_registries</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>registry_arn</span> = <span style=color:#a6e22e>aws_service_discovery_service</span>.<span style=color:#a6e22e>jenkins_master</span>.<span style=color:#a6e22e>arn</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>port</span>         = <span style=color:#ae81ff>50000</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>load_balancer</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>target_group_arn</span> = <span style=color:#a6e22e>aws_lb_target_group</span>.<span style=color:#a6e22e>jenkins</span>.<span style=color:#a6e22e>arn</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>container_name</span>   = <span style=color:#e6db74>&#34;jenkins_master&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>container_port</span>   = <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>network_configuration</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>assign_public_ip</span> = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>security_groups</span> = [
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>aws_security_group</span>.<span style=color:#a6e22e>outbound</span>.<span style=color:#a6e22e>id</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>aws_security_group</span>.<span style=color:#a6e22e>efs_jenkins_security_group</span>.<span style=color:#a6e22e>id</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>aws_security_group</span>.<span style=color:#a6e22e>jenkins</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>subnets</span> = [
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>aws_subnet</span>.<span style=color:#a6e22e>private</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>id</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>aws_subnet</span>.<span style=color:#a6e22e>private</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>id</span>,
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>The region is also configured within this file. As you can see, we run this on Fargate, because this is easier. The other option would be to use EC2 machines, but this is not necessary.</p><p>Some other important points are</p><ul><li>the configuration of the Fargate version 1.4.0, because otherwise you cannot mount storage into the containers</li><li>the DNS registration of the master and the agent</li><li>the configuration of the Elastic loadbalancer to redirect any incoming traffic to the Jenkins master container on TCP port 8080</li></ul><h3 id=configuration-of-variables>Configuration of variables
<a class=heading-link href=#configuration-of-variables><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>The tags and variables are populated inside the <code>variables.tf</code> file, as listed here:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#75715e># Type of environment e. g. dev or prod
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>variable</span> <span style=color:#e6db74>&#34;environment&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;The name to use for the environment, used in Names etc.&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>type</span>        = <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>default</span>     = <span style=color:#e6db74>&#34;dev&#34;</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Name of the Application
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>variable</span> <span style=color:#e6db74>&#34;application_name&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;The name of the application&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>type</span>        = <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>default</span>     = <span style=color:#e6db74>&#34;jenkins_flutter_thesis&#34;</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Output of the current region
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>data</span> <span style=color:#e6db74>&#34;aws_region&#34;</span> <span style=color:#e6db74>&#34;current&#34;</span> {}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Name of the Admin Account
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>variable</span> <span style=color:#e6db74>&#34;jenkins_accountname&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;The Jenkins Master Account&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>type</span>        = <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>default</span>     = <span style=color:#e6db74>&#34;developer&#34;</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Create a random password for the first login of the administrator account.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;random_string&#34;</span> <span style=color:#e6db74>&#34;jenkins_pass&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>length</span>           = <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>special</span>          = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>override_special</span> = <span style=color:#e6db74>&#34;/@</span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>variable &#34;</span><span style=color:#a6e22e>master_memory_amount</span><span style=color:#e6db74>&#34; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  default     = 1024
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  description = &#34;</span><span style=color:#a6e22e>Soft</span> <span style=color:#a6e22e>RAM</span> <span style=color:#a6e22e>Limit</span> <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>Jenkins</span> <span style=color:#a6e22e>Agent</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>variable &#34;</span><span style=color:#a6e22e>master_cpu_amount</span><span style=color:#e6db74>&#34; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  default     = 512
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  description = &#34;</span><span style=color:#a6e22e>Soft</span> <span style=color:#a6e22e>CPU</span> <span style=color:#a6e22e>Limit</span> <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>Jenkins</span> <span style=color:#a6e22e>Agent</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>variable &#34;</span><span style=color:#a6e22e>agent_memory_amount</span><span style=color:#e6db74>&#34; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  default     = 4096
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  description = &#34;</span><span style=color:#a6e22e>Soft</span> <span style=color:#a6e22e>RAM</span> <span style=color:#a6e22e>Limit</span> <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>Jenkins</span> <span style=color:#a6e22e>Agent</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>variable &#34;</span><span style=color:#a6e22e>agent_cpu_amount</span><span style=color:#e6db74>&#34; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  default     = 2048
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  description = &#34;</span><span style=color:#a6e22e>Soft</span> <span style=color:#a6e22e>CPU</span> <span style=color:#a6e22e>Limit</span> <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>Jenkins</span> <span style=color:#a6e22e>Agent</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>variable &#34;</span><span style=color:#a6e22e>s3_artifact_bucket_name</span><span style=color:#e6db74>&#34; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  default     = &#34;</span><span style=color:#a6e22e>jenkins</span><span style=color:#f92672>-</span><span style=color:#a6e22e>flutter</span><span style=color:#f92672>-</span><span style=color:#a6e22e>artifact</span><span style=color:#f92672>-</span><span style=color:#a6e22e>bucket</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  description = &#34;</span><span style=color:#a6e22e>Default</span> <span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>S3</span> <span style=color:#a6e22e>Bucket</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Jenkins</span> <span style=color:#a6e22e>stores</span> <span style=color:#a6e22e>artifacts</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>variable &#34;</span><span style=color:#a6e22e>s3_folder_prefix_name</span><span style=color:#e6db74>&#34; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  default     = &#34;</span><span style=color:#a6e22e>jenkins_artifacts</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  description = &#34;</span><span style=color:#a6e22e>Default</span> <span style=color:#a6e22e>folder</span> <span style=color:#a6e22e>prefix</span> <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>folder</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>S3</span> <span style=color:#a6e22e>Bucket</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Jenkins</span> <span style=color:#a6e22e>stores</span> <span style=color:#a6e22e>artifacts</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span></code></pre></td></tr></table></div></div><p>Just to mention the most important points:</p><ul><li>Any tags as well as application name comes from this file, it can be configured accordingly</li><li>the administrator&rsquo;s username and password are configured inside this file. This is only for demo purposes, <strong>never do this in a production environment</strong>!</li><li>CPU and memory limits are configured here</li><li>Name and folder prefix for the S3 bucket, where artifacts are stored</li></ul><p>There are of course even more Terraform files, like the ones that create IAM policies, ECS task definitions for Jenkins master and agent or an S3 bucket for storing artifcats.</p><p>The most interesting file is probably the <code>network.tf</code> file, as it contains the most details about the network structure:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">196
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">197
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">198
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">199
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">200
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">201
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">202
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">203
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">204
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">205
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">206
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">207
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">208
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">209
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">210
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">211
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">212
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">213
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">214
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">215
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">216
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">217
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">218
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">219
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">220
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">221
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">222
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">223
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">224
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">225
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">226
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">227
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">228
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">229
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">230
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">231
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">232
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">233
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">234
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">235
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">236
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">237
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">238
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">239
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">240
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">241
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">242
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">243
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">244
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">245
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">246
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">247
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">248
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">249
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">250
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">251
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">252
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">253
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">254
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">255
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">256
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">257
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">258
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">259
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">260
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">261
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">262
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">263
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">264
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#75715e># network.tf
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_vpc&#34;</span> <span style=color:#e6db74>&#34;app-vpc&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cidr_block</span>           = <span style=color:#e6db74>&#34;10.0.0.0/16&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>enable_dns_hostnames</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>enable_dns_support</span>   = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_subnet&#34;</span> <span style=color:#e6db74>&#34;public&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span>            = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>app</span><span style=color:#f92672>-</span><span style=color:#a6e22e>vpc</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>count</span>             = length(var.<span style=color:#a6e22e>public_subnets</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cidr_block</span>        = var.<span style=color:#a6e22e>public_subnets</span>[count.<span style=color:#a6e22e>index</span>]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>availability_zone</span> = var.<span style=color:#a6e22e>azs</span>[count.<span style=color:#a6e22e>index</span>]
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Internet GW
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_internet_gateway&#34;</span> <span style=color:#e6db74>&#34;gw&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span> = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>app</span><span style=color:#f92672>-</span><span style=color:#a6e22e>vpc</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span>        = var.<span style=color:#a6e22e>application_name</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Environment</span> = var.<span style=color:#a6e22e>environment</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_route_table&#34;</span> <span style=color:#e6db74>&#34;route&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span> = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>app</span><span style=color:#f92672>-</span><span style=color:#a6e22e>vpc</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>route</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cidr_block</span> = <span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gateway_id</span> = <span style=color:#a6e22e>aws_internet_gateway</span>.<span style=color:#a6e22e>gw</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span> = <span style=color:#e6db74>&#34;Gatewayroute for </span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>application_name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>environment</span><span style=color:#e6db74>}</span><span style=color:#e6db74> environment&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_route_table_association&#34;</span> <span style=color:#e6db74>&#34;public&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>subnet_id</span>      = <span style=color:#a6e22e>aws_subnet</span>.<span style=color:#a6e22e>public</span>[count.<span style=color:#a6e22e>index</span>].<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>route_table_id</span> = <span style=color:#a6e22e>aws_route_table</span>.<span style=color:#a6e22e>route</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>count</span>          = length(var.<span style=color:#a6e22e>public_subnets</span>)
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Private Subnet
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_subnet&#34;</span> <span style=color:#e6db74>&#34;private&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span>            = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>app</span><span style=color:#f92672>-</span><span style=color:#a6e22e>vpc</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>count</span>             = length(var.<span style=color:#a6e22e>private_subnets</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cidr_block</span>        = var.<span style=color:#a6e22e>private_subnets</span>[count.<span style=color:#a6e22e>index</span>]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>availability_zone</span> = var.<span style=color:#a6e22e>azs</span>[count.<span style=color:#a6e22e>index</span>]
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># NAT Stuff
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Elastic IP for NAT
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_eip&#34;</span> <span style=color:#e6db74>&#34;nat&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc</span>   = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>count</span> = <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_nat_gateway&#34;</span> <span style=color:#e6db74>&#34;ngw&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>subnet_id</span>     = <span style=color:#a6e22e>aws_subnet</span>.<span style=color:#a6e22e>public</span>[count.<span style=color:#a6e22e>index</span>].<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>allocation_id</span> = <span style=color:#a6e22e>aws_eip</span>.<span style=color:#a6e22e>nat</span>[count.<span style=color:#a6e22e>index</span>].<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>count</span>         = length(var.<span style=color:#a6e22e>public_subnets</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>depends_on</span>    = [<span style=color:#a6e22e>aws_internet_gateway</span>.<span style=color:#a6e22e>gw</span>]
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Routing
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_route_table&#34;</span> <span style=color:#e6db74>&#34;public&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span> = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>app</span><span style=color:#f92672>-</span><span style=color:#a6e22e>vpc</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>count</span>  = length(var.<span style=color:#a6e22e>public_subnets</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Name&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Route Table for Public Subnet </span><span style=color:#e6db74>${</span>count.<span style=color:#a6e22e>index</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_route_table&#34;</span> <span style=color:#e6db74>&#34;private&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span> = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>app</span><span style=color:#f92672>-</span><span style=color:#a6e22e>vpc</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>count</span>  = length(var.<span style=color:#a6e22e>private_subnets</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Name&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Route Table for Private Subnet </span><span style=color:#e6db74>${</span>count.<span style=color:#a6e22e>index</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Routing Table Association
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_route_table_association&#34;</span> <span style=color:#e6db74>&#34;public_subnet&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>subnet_id</span>      = <span style=color:#a6e22e>aws_subnet</span>.<span style=color:#a6e22e>public</span>[count.<span style=color:#a6e22e>index</span>].<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>count</span>          = length(var.<span style=color:#a6e22e>public_subnets</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>route_table_id</span> = <span style=color:#a6e22e>aws_route_table</span>.<span style=color:#a6e22e>public</span>[count.<span style=color:#a6e22e>index</span>].<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_route_table_association&#34;</span> <span style=color:#e6db74>&#34;private_subnet&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>subnet_id</span>      = <span style=color:#a6e22e>aws_subnet</span>.<span style=color:#a6e22e>private</span>[count.<span style=color:#a6e22e>index</span>].<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>count</span>          = length(var.<span style=color:#a6e22e>private_subnets</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>route_table_id</span> = <span style=color:#a6e22e>aws_route_table</span>.<span style=color:#a6e22e>private</span>[count.<span style=color:#a6e22e>index</span>].<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Creating the Network Routes
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_route&#34;</span> <span style=color:#e6db74>&#34;public_igw&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>count</span>                  = length(var.<span style=color:#a6e22e>public_subnets</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gateway_id</span>             = <span style=color:#a6e22e>aws_internet_gateway</span>.<span style=color:#a6e22e>gw</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>route_table_id</span>         = <span style=color:#a6e22e>aws_route_table</span>.<span style=color:#a6e22e>public</span>[count.<span style=color:#a6e22e>index</span>].<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>destination_cidr_block</span> = <span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_route&#34;</span> <span style=color:#e6db74>&#34;private_ngw&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>count</span>                  = length(var.<span style=color:#a6e22e>private_subnets</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>nat_gateway_id</span>         = <span style=color:#a6e22e>aws_nat_gateway</span>.<span style=color:#a6e22e>ngw</span>[count.<span style=color:#a6e22e>index</span>].<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>route_table_id</span>         = <span style=color:#a6e22e>aws_route_table</span>.<span style=color:#a6e22e>private</span>[count.<span style=color:#a6e22e>index</span>].<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>destination_cidr_block</span> = <span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_security_group&#34;</span> <span style=color:#e6db74>&#34;https&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>        = <span style=color:#e6db74>&#34;Incoming HTTP&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;HTTP and HTTPS traffic for </span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>environment</span><span style=color:#e6db74>}</span><span style=color:#e6db74> environment of </span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>application_name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span>      = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>app</span><span style=color:#f92672>-</span><span style=color:#a6e22e>vpc</span>.<span style=color:#a6e22e>id</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # HTTP
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>ingress</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>from_port</span>   = <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>to_port</span>     = <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>protocol</span>    = <span style=color:#e6db74>&#34;TCP&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cidr_blocks</span> = [<span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>]
</span></span><span style=display:flex><span>  }<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # HTTPS
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>ingress</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>from_port</span>   = <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>to_port</span>     = <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>protocol</span>    = <span style=color:#e6db74>&#34;TCP&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cidr_blocks</span> = [<span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>egress</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Outbound TCP Connections to Jenkins Master&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>from_port</span>   = <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>protocol</span>    = <span style=color:#e6db74>&#34;TCP&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>to_port</span>     = <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cidr_blocks</span> = [<span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_security_group&#34;</span> <span style=color:#e6db74>&#34;jenkins&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>        = <span style=color:#e6db74>&#34;Jenkins Master&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Allows traffic to Jenkins Master.&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span>      = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>app</span><span style=color:#f92672>-</span><span style=color:#a6e22e>vpc</span>.<span style=color:#a6e22e>id</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # HTTP Alternative
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>ingress</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>from_port</span>       = <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>to_port</span>         = <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>protocol</span>        = <span style=color:#e6db74>&#34;TCP&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cidr_blocks</span>     = [<span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>security_groups</span> = [<span style=color:#a6e22e>aws_security_group</span>.<span style=color:#a6e22e>https</span>.<span style=color:#a6e22e>id</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ingress</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>from_port</span>   = <span style=color:#ae81ff>50000</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>to_port</span>     = <span style=color:#ae81ff>50000</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>protocol</span>    = <span style=color:#e6db74>&#34;TCP&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cidr_blocks</span> = [<span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_security_group&#34;</span> <span style=color:#e6db74>&#34;jenkins_agent&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>        = <span style=color:#e6db74>&#34;Jenkins Agents&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Allows traffic to Jenkins Agents.&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span>      = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>app</span><span style=color:#f92672>-</span><span style=color:#a6e22e>vpc</span>.<span style=color:#a6e22e>id</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # Allow Incoming Traffic on JLNP Port -&gt; 50000
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>ingress</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Allows JLNP Traffic&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>from_port</span>   = <span style=color:#ae81ff>50000</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>protocol</span>    = <span style=color:#e6db74>&#34;tcp&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>self</span>        = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>to_port</span>     = <span style=color:#ae81ff>50000</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Environment&#34;</span> <span style=color:#f92672>=</span> var.<span style=color:#a6e22e>environment</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Application&#34;</span> <span style=color:#f92672>=</span> var.<span style=color:#a6e22e>application_name</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_security_group&#34;</span> <span style=color:#e6db74>&#34;outbound&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>        = <span style=color:#e6db74>&#34;Outbound Traffic&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Allow any outbound traffic for </span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>environment</span><span style=color:#e6db74>}</span><span style=color:#e6db74> environment of </span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>application_name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span>      = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>app</span><span style=color:#f92672>-</span><span style=color:#a6e22e>vpc</span>.<span style=color:#a6e22e>id</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # Any Outbound connections allowing
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>egress</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>from_port</span>   = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>to_port</span>     = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>protocol</span>    = <span style=color:#e6db74>&#34;-1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cidr_blocks</span> = [<span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># DNS Resolution for local zone
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_service_discovery_private_dns_namespace&#34;</span> <span style=color:#e6db74>&#34;jenkins_zone&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>        = <span style=color:#e6db74>&#34;jenkins.local&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;DNS Resolution for </span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>application_name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>environment</span><span style=color:#e6db74>}</span><span style=color:#e6db74> environment&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc</span>         = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>app</span><span style=color:#f92672>-</span><span style=color:#a6e22e>vpc</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Load Balancer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_lb_target_group&#34;</span> <span style=color:#e6db74>&#34;jenkins&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>                 = <span style=color:#e6db74>&#34;Jenkins&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>port</span>                 = <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>protocol</span>             = <span style=color:#e6db74>&#34;HTTP&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>target_type</span>          = <span style=color:#e6db74>&#34;ip&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span>               = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>app</span><span style=color:#f92672>-</span><span style=color:#a6e22e>vpc</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>deregistration_delay</span> = <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>health_check</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>enabled</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>path</span>    = <span style=color:#e6db74>&#34;/login&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>port</span>    = <span style=color:#e6db74>&#34;8080&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>depends_on</span> = [<span style=color:#a6e22e>aws_alb</span>.<span style=color:#a6e22e>jenkins</span>]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_alb&#34;</span> <span style=color:#e6db74>&#34;jenkins&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>               = <span style=color:#e6db74>&#34;Jenkins&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>internal</span>           = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>load_balancer_type</span> = <span style=color:#e6db74>&#34;application&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>subnets</span> = [
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>aws_subnet</span>.<span style=color:#a6e22e>public</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>id</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>aws_subnet</span>.<span style=color:#a6e22e>public</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>id</span>,
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>security_groups</span> = [
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>aws_security_group</span>.<span style=color:#a6e22e>https</span>.<span style=color:#a6e22e>id</span>,
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>depends_on</span> = [<span style=color:#a6e22e>aws_internet_gateway</span>.<span style=color:#a6e22e>gw</span>]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_alb_listener&#34;</span> <span style=color:#e6db74>&#34;jenkins_listener&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>load_balancer_arn</span> = <span style=color:#a6e22e>aws_alb</span>.<span style=color:#a6e22e>jenkins</span>.<span style=color:#a6e22e>arn</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>port</span>              = <span style=color:#e6db74>&#34;80&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>protocol</span>          = <span style=color:#e6db74>&#34;HTTP&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>default_action</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>type</span>             = <span style=color:#e6db74>&#34;forward&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>target_group_arn</span> = <span style=color:#a6e22e>aws_lb_target_group</span>.<span style=color:#a6e22e>jenkins</span>.<span style=color:#a6e22e>arn</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_security_group&#34;</span> <span style=color:#e6db74>&#34;jenkins_agent&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>        = <span style=color:#e6db74>&#34;Jenkins Agents&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Allows traffic to Jenkins Agents.&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span>      = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>jenkins</span><span style=color:#f92672>-</span><span style=color:#a6e22e>vpc</span>.<span style=color:#a6e22e>id</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # Allow Incoming Traffic on JLNP Port -&gt; TCP 50000
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>ingress</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Allows JLNP Traffic&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>from_port</span>   = <span style=color:#ae81ff>50000</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>protocol</span>    = <span style=color:#e6db74>&#34;tcp&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>self</span>        = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>to_port</span>     = <span style=color:#ae81ff>50000</span>
</span></span><span style=display:flex><span>  }<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # Add Tags to the security group, coming from variables.tf
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Environment&#34;</span> <span style=color:#f92672>=</span> var.<span style=color:#a6e22e>environment</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Application&#34;</span> <span style=color:#f92672>=</span> var.<span style=color:#a6e22e>application_name</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>As you can see this file contains a lot of information, what is created by Terraform if you apply the configuration. Long story short:</p><ul><li>create a new VPC, new public and private subets (according to the variables) and assign them routing tables</li><li>assign Elastic IPs to the NAT gateways</li><li>create security groups for incoming and outgoing traffic</li><li>create a DNS service for name resolution</li><li>start an ELB with listener within the two public subnets with a healthcheck</li></ul><p>Now there are still some files missing like the Jenkins master file.</p><h3 id=jenkins-master>Jenkins Master
<a class=heading-link href=#jenkins-master><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>The Jenkins master controls every action done by the agents. If any task needs to be scheduled, the master will start a new ECS container agent. The master is configured like this:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">146
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#75715e># The task definition the Jenkins Master Container
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_ecs_task_definition&#34;</span> <span style=color:#e6db74>&#34;jenkins_master&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>family</span> = <span style=color:#e6db74>&#34;JenkinsThesisAwsDev&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>container_definitions</span> = <span style=color:#f92672>&lt;&lt;EOF</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;name&#34;: &#34;jenkins_master&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;image&#34;: &#34;falconone/jenkins_thesis:latest&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;portMappings&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;containerPort&#34;: 8080,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;hostPort&#34;: 8080
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;containerPort&#34;: 50000,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;hostPort&#34;: 50000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ],
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;environment&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;name&#34;: &#34;EXECUTION_ROLE_ARN&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;value&#34;: &#34;${aws_iam_role.JenkinsThesisAwsDev-task-execution-role.arn}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;name&#34;: &#34;SECURITY_GROUP_IDS&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;value&#34;: &#34;${aws_security_group.jenkins_agent.id},${aws_security_group.outbound.id},${aws_security_group.efs_jenkins_security_group.id}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;name&#34;: &#34;AWS_REGION_NAME&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;value&#34;: &#34;${data.aws_region.current.name}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;name&#34;: &#34;ECS_CLUSTER_NAME&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;value&#34;: &#34;${aws_ecs_cluster.JenkinsThesisAwsDev.name}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;name&#34;: &#34;JENKINS_URL&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;value&#34;: &#34;http://${aws_service_discovery_service.jenkins_master.name}.${aws_service_discovery_private_dns_namespace.jenkins_zone.name}:8080&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;name&#34;: &#34;LOG_GROUP_NAME&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;value&#34;: &#34;/ecs/${var.application_name}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;name&#34;: &#34;IMAGE_NAME&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;value&#34;: &#34;falconone/jenkins-flutter:latest&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;name&#34;: &#34;LOCAL_JENKINS_URL&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;value&#34;: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;name&#34;: &#34;SUBNETS&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;value&#34;: &#34;${aws_subnet.public.id}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;name&#34;: &#34;CPU_AMOUNT&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;value&#34;: &#34;${var.agent_cpu_amount}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;name&#34;: &#34;MEMORY_AMOUNT&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;value&#34;: &#34;${var.agent_memory_amount}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;name&#34;: &#34;PLATFORM_VERSION&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;value&#34;: &#34;1.4.0&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;name&#34;: &#34;BUCKET_NAME&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;value&#34;: &#34;${var.s3_artifact_bucket_name}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;name&#34;: &#34;S3_FOLDER_PREFIX&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;value&#34;: &#34;${var.s3_folder_prefix_name}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;name&#34;: &#34;JENKINS_ADMIN_USERNAME&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;value&#34;: &#34;${var.jenkins_accountname}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;name&#34;: &#34;JENKINS_ADMIN_PASSWORD&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;value&#34;: &#34;${random_string.jenkins_pass.result}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ],
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;logConfiguration&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;logDriver&#34;: &#34;awslogs&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;options&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;awslogs-region&#34;: &#34;eu-central-1&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;awslogs-group&#34;: &#34;/ecs/${var.application_name}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;awslogs-stream-prefix&#34;: &#34;ecs&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>]
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#f92672>EOF</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # See here: https://stackoverflow.com/a/49947471
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>execution_role_arn</span> = <span style=color:#a6e22e>aws_iam_role</span>.<span style=color:#a6e22e>JenkinsThesisAwsDev</span><span style=color:#f92672>-</span><span style=color:#a6e22e>task</span><span style=color:#f92672>-</span><span style=color:#a6e22e>execution</span><span style=color:#f92672>-</span><span style=color:#a6e22e>role</span>.<span style=color:#a6e22e>arn</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>task_role_arn</span>      = <span style=color:#a6e22e>aws_iam_role</span>.<span style=color:#a6e22e>JenkinsThesisAwsDev</span><span style=color:#f92672>-</span><span style=color:#a6e22e>task</span><span style=color:#f92672>-</span><span style=color:#a6e22e>execution</span><span style=color:#f92672>-</span><span style=color:#a6e22e>role</span>.<span style=color:#a6e22e>arn</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # Memory and CPU values for Jenkins Master, can be adjusted in variables.tf
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>cpu</span>                      = var.<span style=color:#a6e22e>master_memory_amount</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>memory</span>                   = var.<span style=color:#a6e22e>master_cpu_amount</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>requires_compatibilities</span> = [<span style=color:#e6db74>&#34;FARGATE&#34;</span>]<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # requirement for AWS ECS Fargate containers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>network_mode</span> = <span style=color:#e6db74>&#34;awsvpc&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>depends_on</span> = [<span style=color:#a6e22e>aws_efs_mount_target</span>.<span style=color:#a6e22e>jenkins_master_home</span>]<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # Storage options for jenkins_home
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>volume</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;service-storage&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>efs_volume_configuration</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>file_system_id</span>          = <span style=color:#a6e22e>aws_efs_file_system</span>.<span style=color:#a6e22e>jenkins_master_home</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>root_directory</span>          = <span style=color:#e6db74>&#34;/var/jenkins_home&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>transit_encryption</span>      = <span style=color:#e6db74>&#34;ENABLED&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>transit_encryption_port</span> = <span style=color:#ae81ff>2999</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>authorization_config</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>access_point_id</span> = <span style=color:#a6e22e>aws_efs_access_point</span>.<span style=color:#a6e22e>jenkins_master_home</span>.<span style=color:#a6e22e>id</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>        # Necessary for other resources like S3, EFS or AWS SSM!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>iam</span> = <span style=color:#e6db74>&#34;ENABLED&#34;</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># DNS Resolution for Jenkins Master
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_service_discovery_service&#34;</span> <span style=color:#e6db74>&#34;jenkins_master&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;master&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>dns_config</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>namespace_id</span> = <span style=color:#a6e22e>aws_service_discovery_private_dns_namespace</span>.<span style=color:#a6e22e>jenkins_zone</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>dns_records</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>ttl</span>  = <span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>type</span> = <span style=color:#e6db74>&#34;A&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>dns_records</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>ttl</span>  = <span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>type</span> = <span style=color:#e6db74>&#34;SRV&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>routing_policy</span> = <span style=color:#e6db74>&#34;MULTIVALUE&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=creating-the-storage-with-terraform>Creating the storage with Terraform
<a class=heading-link href=#creating-the-storage-with-terraform><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>There is also the <code>storage.tf</code> file, which creates all storage related stuff, like the S3 bucket or an EFS access point to mount storage inside the agents:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_security_group&#34;</span> <span style=color:#e6db74>&#34;efs_jenkins_security_group&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>        = <span style=color:#e6db74>&#34;efs_access&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Allows efs access from jenkins master to efs storage on port 2049 for </span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>environment</span><span style=color:#e6db74>}</span><span style=color:#e6db74> environment.&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span>      = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>jenkins</span><span style=color:#f92672>-</span><span style=color:#a6e22e>vpc</span>.<span style=color:#a6e22e>id</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #   EFS default port
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>ingress</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;EFS access&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>from_port</span>   = <span style=color:#ae81ff>2049</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>to_port</span>     = <span style=color:#ae81ff>2049</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>protocol</span>    = <span style=color:#e6db74>&#34;tcp&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>    # security_groups = [aws_security_group.efs_jenkins_security_group.id]
</span></span></span><span style=display:flex><span><span style=color:#75715e>    # Self is required to allow access for this group on EFS storage
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>self</span> = <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Create the EFS Storage
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_efs_file_system&#34;</span> <span style=color:#e6db74>&#34;jenkins_master_home&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>creation_token</span> = <span style=color:#e6db74>&#34;jenkins_master&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span>        = <span style=color:#e6db74>&#34;jenkins_master&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>environment</span> = var.<span style=color:#a6e22e>environment</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Create the EFS Mount Target
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_efs_mount_target&#34;</span> <span style=color:#e6db74>&#34;jenkins_master_home&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>file_system_id</span>  = <span style=color:#a6e22e>aws_efs_file_system</span>.<span style=color:#a6e22e>jenkins_master_home</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>subnet_id</span>       = <span style=color:#a6e22e>aws_subnet</span>.<span style=color:#a6e22e>public</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>security_groups</span> = [<span style=color:#a6e22e>aws_security_group</span>.<span style=color:#a6e22e>efs_jenkins_security_group</span>.<span style=color:#a6e22e>id</span>]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_efs_access_point&#34;</span> <span style=color:#e6db74>&#34;jenkins_master_home&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>file_system_id</span> = <span style=color:#a6e22e>aws_efs_file_system</span>.<span style=color:#a6e22e>jenkins_master_home</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>posix_user</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>uid</span> = <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gid</span> = <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>root_directory</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>path</span> = <span style=color:#e6db74>&#34;/jenkins-home&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>    # Create the path with this rights, if it does not exist.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>creation_info</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>owner_gid</span>   = <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>owner_uid</span>   = <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>permissions</span> = <span style=color:#ae81ff>755</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># S3 Bucket for Artifact Storage
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_s3_bucket&#34;</span> <span style=color:#e6db74>&#34;jenkins_artifact_storage&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>bucket</span> = var.<span style=color:#a6e22e>s3_artifact_bucket_name</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>acl</span>    = <span style=color:#e6db74>&#34;private&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span>        = var.<span style=color:#a6e22e>s3_artifact_bucket_name</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Environment</span> = var.<span style=color:#a6e22e>environment</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=necessary-policies>Necessary policies
<a class=heading-link href=#necessary-policies><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>As the master starts an agent if necessary, the master needs the right to run new ECS containers. This and even more is configured inside the <code>iam.tf</code> file.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">157
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_iam_role&#34;</span> <span style=color:#e6db74>&#34;JenkinsThesisAwsDev-task-execution-role&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>               = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>application_name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>-task-execution-role&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>assume_role_policy</span> = data.<span style=color:#a6e22e>aws_iam_policy_document</span>.<span style=color:#a6e22e>ecs</span><span style=color:#f92672>-</span><span style=color:#a6e22e>task</span><span style=color:#f92672>-</span><span style=color:#a6e22e>assume</span><span style=color:#f92672>-</span><span style=color:#a6e22e>role</span>.<span style=color:#a6e22e>json</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>data</span> <span style=color:#e6db74>&#34;aws_iam_policy_document&#34;</span> <span style=color:#e6db74>&#34;ecs-task-assume-role&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>statement</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>actions</span> = [<span style=color:#e6db74>&#34;sts:AssumeRole&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>effect</span>  = <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>principals</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>type</span>        = <span style=color:#e6db74>&#34;Service&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>identifiers</span> = [<span style=color:#e6db74>&#34;ecs-tasks.amazonaws.com&#34;</span>]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>data</span> <span style=color:#e6db74>&#34;aws_iam_policy&#34;</span> <span style=color:#e6db74>&#34;ecs-task-execution-role&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>arn</span> = <span style=color:#e6db74>&#34;arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy&#34;</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Attach the above policy to the execution role.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_iam_role_policy_attachment&#34;</span> <span style=color:#e6db74>&#34;ecs-task-execution-role-default&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>role</span>       = <span style=color:#a6e22e>aws_iam_role</span>.<span style=color:#a6e22e>JenkinsThesisAwsDev</span><span style=color:#f92672>-</span><span style=color:#a6e22e>task</span><span style=color:#f92672>-</span><span style=color:#a6e22e>execution</span><span style=color:#f92672>-</span><span style=color:#a6e22e>role</span>.<span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>policy_arn</span> = data.<span style=color:#a6e22e>aws_iam_policy</span>.<span style=color:#a6e22e>ecs</span><span style=color:#f92672>-</span><span style=color:#a6e22e>task</span><span style=color:#f92672>-</span><span style=color:#a6e22e>execution</span><span style=color:#f92672>-</span><span style=color:#a6e22e>role</span>.<span style=color:#a6e22e>arn</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Attach the required permissions to the Jenkins Task
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_iam_role_policy_attachment&#34;</span> <span style=color:#e6db74>&#34;ecs-task-execution-role-jenkins&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>role</span>       = <span style=color:#a6e22e>aws_iam_role</span>.<span style=color:#a6e22e>JenkinsThesisAwsDev</span><span style=color:#f92672>-</span><span style=color:#a6e22e>task</span><span style=color:#f92672>-</span><span style=color:#a6e22e>execution</span><span style=color:#f92672>-</span><span style=color:#a6e22e>role</span>.<span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>policy_arn</span> = <span style=color:#a6e22e>aws_iam_policy</span>.<span style=color:#a6e22e>jenkins_agents</span>.<span style=color:#a6e22e>arn</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Data Policy for Jenkins Master to start new Jenkins Agents
</span></span></span><span style=display:flex><span><span style=color:#75715e># https://stackoverflow.com/questions/62831874/terrafrom-aws-iam-policy-document-condition-correct-syntax
</span></span></span><span style=display:flex><span><span style=color:#75715e># https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document#condition
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>data</span> <span style=color:#e6db74>&#34;aws_iam_policy_document&#34;</span> <span style=color:#e6db74>&#34;jenkins_master&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>statement</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>actions</span> = [
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;ecs:RegisterTaskDefinition&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;ecs:ListClusters&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;ecs:DescribeContainerInstances&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;ecs:ListTaskDefinitions&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;ecs:DescribeTaskDefinition&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;ecs:DeregisterTaskDefinition&#34;</span>,
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>resources</span> = [<span style=color:#e6db74>&#34;*&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>effect</span>    = <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>  }<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # Listing of Container Instances
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>statement</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>actions</span>   = [<span style=color:#e6db74>&#34;ecs:ListContainerInstances&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>effect</span>    = <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>resources</span> = [<span style=color:#a6e22e>aws_ecs_cluster</span>.<span style=color:#a6e22e>JenkinsThesisAwsDev</span>.<span style=color:#a6e22e>arn</span>]
</span></span><span style=display:flex><span>  }<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # Run Tasks in ECS
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>statement</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>actions</span>   = [<span style=color:#e6db74>&#34;ecs:RunTask&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>effect</span>    = <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>resources</span> = [<span style=color:#e6db74>&#34;arn:aws:ecs:</span><span style=color:#e6db74>${</span>data.<span style=color:#a6e22e>aws_region</span>.<span style=color:#a6e22e>current</span>.<span style=color:#a6e22e>name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>:526531137161:task-definition/*&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>condition</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>test</span>     = <span style=color:#e6db74>&#34;ArnEquals&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>      variable</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ecs:cluster&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>values</span> = [
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>aws_ecs_cluster</span>.<span style=color:#a6e22e>JenkinsThesisAwsDev</span>.<span style=color:#a6e22e>arn</span>
</span></span><span style=display:flex><span>      ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>statement</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>actions</span> = [<span style=color:#e6db74>&#34;ecs:StopTask&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>effect</span>  = <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>resources</span> = [
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;arn:aws:ecs:*:*:task/*&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;arn:aws:ecs:</span><span style=color:#e6db74>${</span>data.<span style=color:#a6e22e>aws_region</span>.<span style=color:#a6e22e>current</span>.<span style=color:#a6e22e>name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>:526531137161:task/*&#34;</span>
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>condition</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>test</span>     = <span style=color:#e6db74>&#34;ArnEquals&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>      variable</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ecs:cluster&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>values</span> = [
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>aws_ecs_cluster</span>.<span style=color:#a6e22e>JenkinsThesisAwsDev</span>.<span style=color:#a6e22e>arn</span>
</span></span><span style=display:flex><span>      ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>statement</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>actions</span> = [<span style=color:#e6db74>&#34;ecs:DescribeTasks&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>effect</span>  = <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>resources</span> = [
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;arn:aws:ecs:*:*:task/*&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;arn:aws:ecs:</span><span style=color:#e6db74>${</span>data.<span style=color:#a6e22e>aws_region</span>.<span style=color:#a6e22e>current</span>.<span style=color:#a6e22e>name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>:526531137161:task/*&#34;</span>
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>condition</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>test</span>     = <span style=color:#e6db74>&#34;ArnEquals&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>      variable</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ecs:cluster&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>values</span> = [
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>aws_ecs_cluster</span>.<span style=color:#a6e22e>JenkinsThesisAwsDev</span>.<span style=color:#a6e22e>arn</span>
</span></span><span style=display:flex><span>      ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>statement</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>actions</span>   = [<span style=color:#e6db74>&#34;iam:GetRole&#34;</span>, <span style=color:#e6db74>&#34;iam:PassRole&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>effect</span>    = <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>resources</span> = [<span style=color:#a6e22e>aws_iam_role</span>.<span style=color:#a6e22e>JenkinsThesisAwsDev</span><span style=color:#f92672>-</span><span style=color:#a6e22e>task</span><span style=color:#f92672>-</span><span style=color:#a6e22e>execution</span><span style=color:#f92672>-</span><span style=color:#a6e22e>role</span>.<span style=color:#a6e22e>arn</span>]
</span></span><span style=display:flex><span>  }<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # S3 Bucket Related policys for storing build artifacts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>statement</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>actions</span> = [
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;s3:ListBucket&#34;</span>
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>effect</span>    = <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sid</span>       = <span style=color:#e6db74>&#34;AllowListingOfFolder&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>resources</span> = [<span style=color:#a6e22e>aws_s3_bucket</span>.<span style=color:#a6e22e>jenkins_artifact_storage</span>.<span style=color:#a6e22e>arn</span>]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>condition</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>test</span>     = <span style=color:#e6db74>&#34;StringLike&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>      variable</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;s3:prefix&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>values</span>   = [<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>s3_folder_prefix_name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/*&#34;</span>]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # Allow the listing of bucket locations.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>statement</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>actions</span> = [
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;s3:GetBucketLocation&#34;</span>
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>effect</span>    = <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sid</span>       = <span style=color:#e6db74>&#34;AllowListingOfBuckets&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>resources</span> = [<span style=color:#a6e22e>aws_s3_bucket</span>.<span style=color:#a6e22e>jenkins_artifact_storage</span>.<span style=color:#a6e22e>arn</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>statement</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sid</span>    = <span style=color:#e6db74>&#34;AllowS3ActionsInFolder&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>effect</span> = <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>actions</span> = [
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;s3:PutObject&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;s3:GetObject&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;s3:DeleteObject&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;s3:ListBucket&#34;</span>,
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>resources</span> = [<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>aws_s3_bucket</span>.<span style=color:#a6e22e>jenkins_artifact_storage</span>.<span style=color:#a6e22e>arn</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>s3_folder_prefix_name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/*&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Policy for Jenkins Master to start new Jenkins Agents
</span></span></span><span style=display:flex><span><span style=color:#75715e># https://stackoverflow.com/questions/62831874/terrafrom-aws-iam-policy-document-condition-correct-syntax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_iam_policy&#34;</span> <span style=color:#e6db74>&#34;jenkins_agents&#34;</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Allows the Jenkins master to start new agents.&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>        = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>application_name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>_ecs_policy&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # Policy
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # Hint: Curly braces may not be indented otherwise Terraform fails
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>policy</span> = data.<span style=color:#a6e22e>aws_iam_policy_document</span>.<span style=color:#a6e22e>jenkins_master</span>.<span style=color:#a6e22e>json</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=conclusion>Conclusion
<a class=heading-link href=#conclusion><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>With everything of the files listed above the necessary AWS infrastructure is created within a few minutes. No need to click or anything else, you just have to run a <code>terraform apply</code> from the commandline. As it&rsquo;s hard to get all the code inside this document, I created a <a href=https://github.com/pgrunm/aws_jenkins_flutter class=external-link target=_blank rel=noopener>new repository on Github</a>, where I&rsquo;ll upload all the required code.</p><p>The cool thing about all the stuff above is, it created everthing and from now on we only have to worry about the container setup. The container setup I&rsquo;m going to cover in part 2 of the series.</p><p>If you have any questions, do not hesitate to contact me! I hope you enjoyed reading this post and we will see each other in part 2, where we talk about how to configure the Jenkins master and agent.</p><p>See more in <a href=https://pgrunm.github.io/posts/infrastructure_flutter_part2>part 2 of the series</a>.</p></div><footer></footer></article><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css integrity=sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0 crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js integrity=sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})'></script></section></div><section class=container><center>© 2019 - 2024 | Built with &#9829;&#xfe0f; by Pascal Grundmeier - DevOps engineering at scale.</center></section></main><script src=https://pgrunm.github.io/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>